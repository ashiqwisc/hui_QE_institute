---
title: "ENA Model Zero for Dr. Bowen Hui of UBC"
output:
  html_document:
    df_print: paged
editor_options: 
  chunk_output_type: inline
---
## 0. Setup 
```{r}
library(rENA)
library(magrittr)
library(scales)
library(tidyverse)
setwd("~/Desktop/epistemic_analytics/hui_QE_institute")
df <- read.csv("./datasets/reformatted_hui_data.csv") %>%
  select(-X)
```

## 1. Define units, conversations, codes
```{r}
# units = df[, c("students", "week", "commitment_level")]
units = df[, c("week", "students", "commitment_level")]
conversations = df[, c("students", "week", "commitment_level")]
code_cols = c(
  "Task.done.on.time.1", "Task.done.on.time.2", "Work.accepted.by.others.1", "Work.accepted.by.others.2", "Positive.tone.1",     "Positive.tone.2", "Initiate.conversations.1",  "Initiate.conversations.2",  "Help.others.1", "Help.others.2",                 "Completes.more.tasks.1", "Completes.more.tasks.2", "Assigns.tasks.1", "Assigns.tasks.2", "Review.work.from.others.1",         "Review.work.from.others.2", "Initiate.meeting.1", "Initiate.meeting.2"
)
codes = df[, code_cols]
```

## 2. Accumulate, make set
```{r}
# Arbitrary window size of 4 chosen
accum = ena.accumulate.data(
  units = units,
  conversation = conversations,
  codes = codes,
  window.size.back = 4
)

set = ena.make.set(
  enadata = accum
)
```

## 3. Plot 

### Define points and line weights
```{r}
low_points = as.matrix(set$points$commitment_level$low)
mid_points = as.matrix(set$points$commitment_level$mid)
high_points = as.matrix(set$points$commitment_level$high)
points_max = max(low_points, mid_points, high_points)

# low_points_scaled = scales::rescale(low_points,
#                                     c(0,max(as.matrix(set$rotation$nodes))), c(0,points_max))
# mid_points_scaled = scales::rescale(mid_points,
#                                      c(0,max(as.matrix(set$rotation$nodes))), c(0,points_max))
# high_points_scaled = scales::rescale(high_points,
#                                      c(0,max(as.matrix(set$rotation$nodes))), c(0,points_max))

low_lw = as.matrix(set$line.weights$commitment_level$low)
low_mean = as.vector(colMeans(low_lw))
mid_lw = as.matrix(set$line.weights$commitment_level$mid)
mid_mean = as.vector(colMeans(mid_lw))
high_lw = as.matrix(set$line.weights$commitment_level$high)
high_mean = as.vector(colMeans(high_lw))
```

### Plot for low students
```{r}
plot_low = ena.plot(set, title = "Mean Low Network", font.family = "Times") %>%
  #ena.plot.points(points = low_points, colors = c("red")) %>%
  ena.plot.group(points = low_points, colors =c("red"),
                         confidence.interval = "box") %>% 
  ena.plot.network(network = low_mean)
plot_low$plot 
```

### Plot for mid students
```{r}
plot_mid = ena.plot(set, title = "Mean Mid Network") %>%
  #ena.plot.points(points = mid_points, colors = c("blue")) %>%
    ena.plot.group(points = mid_points, colors =c("blue"),
                         confidence.interval = "box") %>% 
  ena.plot.network(network = mid_mean)
plot_mid$plot
```

### Plot for high students
```{r}
plot_high = ena.plot(set, title = "Mean High Network") %>%
 #  ena.plot.points(points = high_points, colors = c("orange")) %>%
  ena.plot.group(points = high_points, colors =c("orange"),
                         confidence.interval = "box") %>% 
  ena.plot.network(network = high_mean)
plot_high$plot
```


